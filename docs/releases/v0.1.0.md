# Release v0.1.0

**Release Date:** 2025-01-23
**Git Tag:** v0.1.0 (pending)
**Go Version:** 1.25.1

## 🎯 Highlights

Initial alpha release of ocserv-agent with **Phase 1: Core** complete. This release provides a production-ready foundation with configuration management, gRPC server with mTLS authentication, basic health checks, and graceful shutdown.

## ✨ New Features

- **[Project Structure]** - Complete project scaffolding
  - Directory structure (cmd/, internal/, pkg/, deploy/, docs/, test/)
  - Go module with all required dependencies
  - Podman Compose infrastructure (dev, test, build)
  - Dockerfile multi-stage build
  - systemd service file with security hardening
  - Commit: cc69c82

- **[Configuration Management]** - internal/config package
  - YAML configuration loading from file
  - Environment variable overrides
  - Comprehensive validation (TLS, ocserv, health, logging, security)
  - Smart defaults and auto-detect hostname
  - Support for all agent settings
  - Commit: a899a75

- **[gRPC Server with mTLS]** - Production-ready gRPC server
  - mTLS authentication with client certificate verification
  - TLS 1.3/1.2 support with secure cipher suites
  - Unary and stream interceptors (logging, recovery)
  - Graceful shutdown support
  - File: internal/grpc/server.go
  - Commit: 110d823

- **[HealthCheck Endpoint]** - Basic health monitoring
  - Tier 1 (heartbeat) fully implemented
  - Returns agent status, config loaded, timestamp
  - Tier 2 and 3 stubs for future deep checks
  - File: internal/grpc/handlers.go
  - Commit: 110d823

- **[Main Entrypoint]** - Robust application lifecycle
  - Config loading with error handling
  - Signal handling (SIGTERM, SIGINT, SIGHUP)
  - Graceful shutdown with 30s timeout
  - Zerolog setup (JSON and console formats)
  - Version flag support
  - File: cmd/agent/main.go
  - Commit: 110d823

- **[Protocol Definitions]** - gRPC/protobuf API specification
  - AgentService with 5 RPC methods
  - Message types for heartbeat, metrics, commands, config updates
  - Generated protobuf code (agent.pb.go, agent_grpc.pb.go)
  - File: pkg/proto/agent/v1/agent.proto
  - Commit: cc69c82

- **[Development Infrastructure]** - Podman Compose workflow
  - Hot-reload development environment (Air)
  - Containerized testing (unit, integration, lint, security)
  - Multi-architecture build support (amd64, arm64)
  - Proto generation in containers
  - Mock control server and mock ocserv stubs
  - Commits: cc69c82

- **[Documentation]** - Comprehensive project docs
  - README.md with quickstart and roadmap
  - TODO management system (CURRENT.md, BACKLOG.md, DONE.md)
  - Release notes structure
  - Makefile with detailed help
  - Commits: cc69c82, 1a97fe9, f6b7436

- **[SystemctlManager]** - Service lifecycle management (Phase 2)
  - Start, stop, restart, reload operations
  - Status checks: is-active, is-enabled, detailed status
  - Service information parsing (ActiveState, SubState, MainPID, LoadState)
  - Sudo support for non-root execution
  - Timeout handling for all operations
  - File: internal/ocserv/systemctl.go (246 lines)
  - Commit: 56da3c5

- **[OcctlManager]** - ocserv control operations (Phase 2)
  - Show users - list connected VPN users
  - Show status - server status (uptime, sec-mod, compression)
  - Show stats - statistics (active users, sessions, bandwidth)
  - Disconnect user by username
  - Disconnect session by ID
  - Output parsing for structured data
  - Socket path configuration
  - JSON marshaling support for large numbers
  - File: internal/ocserv/occtl.go (385 lines)
  - Commit: 56da3c5

- **[Manager with Security]** - Unified command execution (Phase 2)
  - Combines SystemctlManager and OcctlManager
  - Whitelist-based command filtering
  - Comprehensive argument validation
  - Command injection prevention (regex-based)
  - Protection against: shell metacharacters, directory traversal, null bytes
  - Length limits (256 chars per argument)
  - CommandResult struct for standardized responses
  - Route commands to appropriate handlers
  - File: internal/ocserv/manager.go (312 lines)
  - Commit: 56da3c5

- **[ExecuteCommand RPC - Production Ready]** - (Phase 2)
  - Full integration with ocserv.Manager
  - Returns stdout, stderr, exit code, error messages
  - Proper error handling and logging
  - Context propagation for cancellation
  - Security validation on all inputs
  - File: internal/grpc/handlers.go (updated)
  - Commit: 56da3c5

## 🐛 Bug Fixes

None (initial release)

## 🔧 Improvements

None (initial release)

## 🔒 Security

- **[mTLS Authentication]** - Client certificate verification required
  - TLS 1.3 minimum version (configurable to TLS 1.2)
  - Secure cipher suites: TLS_AES_256_GCM_SHA384, TLS_CHACHA20_POLY1305_SHA256
  - Server name verification

- **[Configuration Validation]** - Security-focused config checks
  - Certificate file existence validation
  - Command whitelist enforcement
  - Timeout limits for command execution

- **[systemd Hardening]** - Production security features
  - NoNewPrivileges, PrivateTmp, ProtectSystem
  - Capability-based security (CAP_NET_ADMIN only)
  - Resource limits (memory, CPU, tasks)

- **[Command Injection Prevention]** - (Phase 2) ✅
  - Whitelist-based command filtering (only occtl, systemctl allowed)
  - Regex-based argument validation
  - Protection against shell metacharacters: `; & | > < $ ( ) { } [ ]`
  - Directory traversal prevention: `../`
  - Flag injection prevention: arguments starting with `-`
  - Null byte detection: `\x00`
  - Length limits: max 256 characters per argument
  - File: internal/ocserv/manager.go

**Note:** This is an alpha release with production-ready security features for command execution. Full security audit pending for other components.

## 📚 Documentation

- Created README.md with project overview
- Created Makefile with comprehensive help
- Created TODO management system
- Created release notes structure

## ⚠️ Breaking Changes

None (initial release)

## 🔄 Dependencies

### Added
- google.golang.org/grpc v1.69.4
- google.golang.org/protobuf v1.36.3
- github.com/rs/zerolog v1.33.0
- go.opentelemetry.io/otel v1.34.0
- gopkg.in/yaml.v3 v3.0.1

## 📊 Statistics

- Commits: 9
  - cc69c82: Initial setup (23 files, 4341+ lines)
  - 1a97fe9: TODO update
  - a899a75: Config package (2 files, 480 lines)
  - 110d823: gRPC + HealthCheck + main (3 files, 480 lines)
  - f6b7436: Phase 1 completion docs
  - 678b766: Exclude .claude directory
  - 55bac55: Release notes and TODO update
  - 56da3c5: Phase 2 ocserv integration (5 files, 943 lines) ✅
  - 4c640d0: Phase 2 TODO update
- Files Changed: 35+
- Contributors: 1
- Test Coverage: 0% (tests pending)
- Lines of Code: ~6,500+
  - internal/config: ~480 lines
  - internal/grpc: ~500 lines
  - internal/ocserv: ~950 lines (Phase 2)
  - cmd/agent: ~150 lines
  - Total Go code: ~2,100 lines
- Lines Added: ~6,500
- Lines Deleted: ~200

## 🙏 Contributors

- Initial setup and infrastructure

## 📦 Installation

### Development Build

```bash
git clone https://github.com/dantte-lp/ocserv-agent.git
cd ocserv-agent
make compose-build  # Build in containers (recommended)
```

### Requirements

- Podman and podman-compose (for containerized builds)
- Or: Go 1.25+, protoc (for local builds)
- TLS certificates (CA, server cert, client cert for testing)

## 🧪 Testing

**Status:** Testing infrastructure ready, unit tests pending

```bash
# Run tests (when implemented)
make compose-test

# Build and verify compilation
make compose-build
```

**Test Coverage:** 0% (Phase 1.5 will add tests)

## 📝 Notes

**Phase 1: Core - COMPLETED ✅**

All core functionality implemented:
- ✅ Configuration loading and validation
- ✅ gRPC server with mTLS
- ✅ HealthCheck endpoint (Tier 1)
- ✅ Graceful shutdown
- ✅ Comprehensive documentation

**Phase 2: ocserv Integration - COMPLETED ✅**

All ocserv management implemented:
- ✅ Systemctl wrapper (start, stop, restart, reload, status)
- ✅ Occtl wrapper (show users/status/stats, disconnect)
- ✅ Command validation and security
- ✅ ExecuteCommand RPC fully functional
- ✅ Production-ready security (command injection prevention)

**Known Limitations:**
- No unit tests yet (planned for separate phase)
- HealthCheck Tier 2 and 3 are stubs
- RPC methods (UpdateConfig, StreamLogs, AgentStream) are stubs
- Config file reading not yet implemented
- No heartbeat/streaming features yet

**What Works (Production Ready):**
- ✅ mTLS authentication
- ✅ Configuration management
- ✅ ExecuteCommand RPC with full ocserv control
- ✅ Systemctl operations (service lifecycle)
- ✅ Occtl operations (user management, statistics)
- ✅ Command security (whitelist, validation, injection prevention)
- ✅ Graceful shutdown

**Next Steps (Phase 3 - Streaming & Advanced Features):**
1. Bidirectional streaming (AgentStream)
2. Heartbeat implementation with metrics
3. Log streaming (StreamLogs)
4. Config updates with backup (UpdateConfig)
5. HealthCheck Tier 2 and 3 (deep checks)
6. Unit tests for all packages
7. Config file reading (ocserv.conf, per-user, per-group)

## 🔗 Links

- [Repository](https://github.com/dantte-lp/ocserv-agent)
- [Documentation](https://github.com/dantte-lp/ocserv-agent/tree/main/docs)
