# Release Notes - v0.3.0

**Release Date:** 2025-10-23
**Type:** MINOR - Certificate Auto-Generation + Build Improvements
**Status:** BETA

## üìã Summary

Major feature release adding automatic certificate generation for zero-config deployment. No more "cert_file not found" errors on first run!

## üéØ Key Features

### üîê Certificate Auto-Generation (Bootstrap Mode)

**Problem Solved:** Agent failed to start with "cert_file not found" error on production servers.

**Solution:** Automatic self-signed certificate generation with combined automatic + manual control.

#### Automatic Generation
```yaml
tls:
  enabled: true
  auto_generate: true  # New feature!
  cert_file: "/etc/ocserv-agent/certs/agent.crt"
  key_file: "/etc/ocserv-agent/certs/agent.key"
  ca_file: "/etc/ocserv-agent/certs/ca.crt"
```

On first run:
- ‚úÖ Auto-generates self-signed CA + agent cert + key
- ‚úÖ ECDSA P-256, 1 year validity
- ‚úÖ Displays SHA256 fingerprints for verification
- ‚úÖ Secure permissions (0644 certs, 0600 keys)
- ‚úÖ Informative warnings about self-signed usage

#### Manual Generation (CLI)
```bash
# Generate certificates manually
ocserv-agent gencert -output /etc/ocserv-agent/certs

# Custom hostname
ocserv-agent gencert -hostname vpn.example.com

# Help and version
ocserv-agent help
ocserv-agent version
```

#### Features
- **Bootstrap Mode** - Self-signed certs for autonomous operation
- **Production Mode** - Easy migration to CA-signed certificates
- **Security** - TLS 1.3 encryption even with self-signed
- **Fingerprint Verification** - SHA256 hashes for secure verification

### üì¶ Build Improvements

**Versioned Archives:**
- Format: `ocserv-agent-{version}-{os}-{arch}.tar.gz`
- Example: `ocserv-agent-v0.3.0-linux-amd64.tar.gz`
- Binary inside always named `ocserv-agent`

**Platforms:**
- Linux (amd64/x86_64, arm64/aarch64)
- FreeBSD (amd64/x86_64, arm64/aarch64)

**SHA256 Checksums:**
- All archives include `.sha256` checksum files
- SLSA Level 3 provenance for secure builds

### üêõ CI/CD Fixes

**Go Toolchain:**
- Fixed "no such tool covdata" error in CI
- Updated to Go 1.25 with toolchain directive
- Proper version management with go.mod

## üì¶ What's Changed

<details>
<summary><strong>Click to expand detailed changes</strong></summary>

### New Features

**Certificate Management (internal/cert)**
- `GenerateSelfSignedCerts()` - Create CA + cert + key
- ECDSA P-256 algorithm
- SHA256 fingerprint calculation
- Proper file permissions handling
- 1-year validity period

**Config Auto-Generate**
- `auto_generate: true` option in TLS config
- `bootstrapCertificates()` in config loader
- Conditional validation (skip file check if auto_generate)
- Informative console output

**CLI Commands**
- `ocserv-agent gencert` - Generate certificates
- `ocserv-agent help` - Usage guide
- `ocserv-agent version` - Version info
- Flags: `-output`, `-hostname`, `-self-signed`

**Build System**
- Versioned tar.gz archives
- FreeBSD support (amd64, arm64)
- Multi-platform builds in parallel
- SHA256 checksums for all artifacts

### Documentation

**New Guides:**
- `docs/CERTIFICATES.md` - Complete certificate management guide
  - Bootstrap vs Production modes
  - CLI command reference
  - Security considerations
  - Troubleshooting
  - Migration workflows

- `TESTING_PROD.md` - Production testing guide
  - Step-by-step testing instructions
  - Success criteria
  - Troubleshooting tips

**Updated:**
- Sanitized all sensitive data (IPs, hostnames, credentials)
- RFC-compliant examples (RFC 5737, RFC 2606)
- Platform documentation updates

### Code Changes

**Files Added:**
- `internal/cert/generator.go` - Certificate generation logic
- `docs/CERTIFICATES.md` - Certificate management guide
- `TESTING_PROD.md` - Production testing guide
- `docs/releases/v0.3.0.md` - This file

**Files Modified:**
- `internal/config/config.go` - Auto-generate field, bootstrap logic
- `internal/config/validation.go` - Conditional cert validation
- `cmd/agent/main.go` - CLI subcommands (gencert, help, version)
- `config.yaml.example` - Document auto_generate option
- `.github/workflows/release.yml` - Versioned archives
- `deploy/compose/docker-compose.build.yml` - All 4 platforms
- `go.mod` - Toolchain directive

### Bug Fixes

**CI/CD:**
- Fixed Go 1.24 "covdata" tool error
- Updated to Go 1.25 with toolchain
- Removed Go 1.24 from test matrix

**Security:**
- Sanitized sensitive data in documentation
- RFC-compliant example IPs (203.0.113.x)
- Generic hostnames and usernames

</details>

## üöÄ Usage Examples

<details>
<summary><strong>Click to expand usage examples</strong></summary>

### Quick Start (Auto-Generate)

```bash
# 1. Install agent
sudo mkdir -p /etc/ocserv-agent
sudo cp ocserv-agent /etc/ocserv-agent/
sudo chmod +x /etc/ocserv-agent/ocserv-agent

# 2. Create config with auto-generation
cat > /etc/ocserv-agent/config.yaml <<EOF
agent_id: "vpn-server-01"
tls:
  enabled: true
  auto_generate: true  # Auto-generate on first run!
  cert_file: "/etc/ocserv-agent/certs/agent.crt"
  key_file: "/etc/ocserv-agent/certs/agent.key"
  ca_file: "/etc/ocserv-agent/certs/ca.crt"
# ... other config
EOF

# 3. Start agent (certs auto-generated)
sudo ocserv-agent -config /etc/ocserv-agent/config.yaml
```

**Output:**
```
üîê Generated self-signed certificates for bootstrap mode
   CA Fingerprint:   SHA256:a1:b2:c3:...
   Cert Fingerprint: SHA256:e5:f6:g7:...
   Subject:          ocserv-agent-vpn-server-01
   Valid:            2025-10-23 - 2026-10-23
   Location:         /etc/ocserv-agent/certs

‚ö†Ô∏è  These are self-signed certificates for autonomous operation.
   To connect to a control server, replace with CA-signed certificates.
```

### Manual Generation

```bash
# Generate certificates
sudo ocserv-agent gencert \
  -output /etc/ocserv-agent/certs \
  -hostname vpn.example.com

# Verify
openssl x509 -in /etc/ocserv-agent/certs/agent.crt -text -noout
openssl verify -CAfile /etc/ocserv-agent/certs/ca.crt \
  /etc/ocserv-agent/certs/agent.crt
```

### Download and Extract

```bash
# Download archive
wget https://github.com/dantte-lp/ocserv-agent/releases/download/v0.3.0/ocserv-agent-v0.3.0-linux-amd64.tar.gz

# Verify checksum
wget https://github.com/dantte-lp/ocserv-agent/releases/download/v0.3.0/ocserv-agent-v0.3.0-linux-amd64.tar.gz.sha256
sha256sum -c ocserv-agent-v0.3.0-linux-amd64.tar.gz.sha256

# Extract (binary inside is named 'ocserv-agent')
tar -xzf ocserv-agent-v0.3.0-linux-amd64.tar.gz

# Install to /etc/ocserv-agent
sudo mkdir -p /etc/ocserv-agent
sudo mv ocserv-agent /etc/ocserv-agent/
sudo chmod +x /etc/ocserv-agent/ocserv-agent
```

</details>

## üîí Security

### Certificate Security

**Self-Signed Certificates:**
- ‚úÖ TLS 1.3 encryption (same as CA-signed)
- ‚úÖ Good for autonomous operation
- ‚úÖ Fingerprint verification available
- ‚ö†Ô∏è No chain of trust (bootstrap only)

**Migration to Production:**
1. Start with auto-generated certs
2. Verify fingerprints via secure channel
3. Replace with CA-signed certs for production
4. Set `auto_generate: false`

### Build Security

- **SLSA Level 3** provenance for all releases
- **SHA256 checksums** for verification
- **Multi-platform** reproducible builds
- **No embedded secrets** in binaries

## üìä Statistics

### Code Changes
- **Files changed:** 15
- **Lines added:** ~1,500
- **Lines removed:** ~50
- **Net change:** +1,450 lines

### Commits Since v0.2.1
- 4 commits
- 1 feature (certificate auto-generation)
- 1 build improvement (versioned archives)
- 1 documentation (sanitization)
- 1 bugfix (CI toolchain)

## üîç Compatibility

**Breaking Changes:** None

**New Requirements:**
- Go 1.25+ for development (was 1.24+)

**Dependencies:**
- Go: 1.25 (toolchain: go1.25.3)
- gRPC: 1.69.4 (no change)
- protobuf: 1.36.4 (no change)
- zerolog: 1.33.0 (no change)
- golang.org/x/net: 0.38.0 (from v0.2.1)

**Binary Compatibility:**
- ‚úÖ Fully compatible with v0.2.1
- ‚úÖ Config file compatible (new optional field)
- ‚úÖ No API changes

## üöÄ Deployment

<details>
<summary><strong>Click to expand deployment guide</strong></summary>

### Upgrade from v0.2.1

```bash
# 1. Download new version
wget https://github.com/dantte-lp/ocserv-agent/releases/download/v0.3.0/ocserv-agent-v0.3.0-linux-amd64.tar.gz
tar -xzf ocserv-agent-v0.3.0-linux-amd64.tar.gz

# 2. Backup current binary
sudo cp /etc/ocserv-agent/ocserv-agent /etc/ocserv-agent/ocserv-agent.v0.2.1

# 3. Install new version
sudo cp ocserv-agent /etc/ocserv-agent/
sudo chmod +x /etc/ocserv-agent/ocserv-agent

# 4. Optional: Enable auto-generation in config
# Add to config.yaml:
#   tls:
#     auto_generate: true

# 5. Restart service
sudo systemctl restart ocserv-agent
```

### Fresh Install

```bash
# Extract and install
tar -xzf ocserv-agent-v0.3.0-linux-amd64.tar.gz
sudo mkdir -p /etc/ocserv-agent
sudo mv ocserv-agent /etc/ocserv-agent/
sudo chmod +x /etc/ocserv-agent/ocserv-agent

# Create config with auto-generation
sudo cp config.yaml.example /etc/ocserv-agent/config.yaml
# Edit config, set auto_generate: true

# Start agent
sudo ocserv-agent -config /etc/ocserv-agent/config.yaml
```

</details>

## üìù Full Changelog

<details>
<summary><strong>Click to expand full changelog</strong></summary>

### Features
- Add certificate auto-generation for bootstrap mode (#208021b)
- Add CLI commands: gencert, help, version (#208021b)
- Add versioned archive packaging (#520a42b)
- Add FreeBSD build support (amd64, arm64) (#520a42b)

### Bug Fixes
- Fix Go 1.24 covdata tool issue in CI (#a710481)

### Documentation
- Add comprehensive certificate management guide (#208021b)
- Add production testing guide (#520a42b)
- Sanitize sensitive data with RFC examples (#2d50a1c)
- Update TODO and release notes (#07d02ed)

### Build
- Update packaging with version in archive names (#520a42b)
- Add toolchain directive to go.mod (#a710481)
- Remove Go 1.24 from CI test matrix (#a710481)

</details>

## üêõ Known Issues

None reported for v0.3.0

## üîÆ Next Steps

See [TODO](../todo/CURRENT.md) for upcoming features.

**Planned for v0.4.0:**
- StreamLogs RPC implementation
- ShowEvents() streaming support
- ocpasswd wrapper
- UpdateConfig RPC
- Unit tests (>80% coverage)

## üìö References

- [Certificate Management Guide](../CERTIFICATES.md)
- [Production Testing Guide](../../TESTING_PROD.md)
- [Contributing Guide](../../.github/CONTRIBUTING.md)
- [Workflows Documentation](../../.github/WORKFLOWS.md)
- [Previous Release (v0.2.1)](v0.2.1.md)

## üîó Downloads

<details>
<summary><strong>Click to expand download links and verification</strong></summary>

**Release Assets:**
- `ocserv-agent-v0.3.0-linux-amd64.tar.gz` - Linux x86_64
- `ocserv-agent-v0.3.0-linux-arm64.tar.gz` - Linux ARM64/aarch64
- `ocserv-agent-v0.3.0-freebsd-amd64.tar.gz` - FreeBSD x86_64
- `ocserv-agent-v0.3.0-freebsd-arm64.tar.gz` - FreeBSD ARM64/aarch64
- `*.sha256` - SHA256 checksums
- `*.intoto.jsonl` - SLSA provenance

**SLSA Verification:**
```bash
# Install slsa-verifier
go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@latest

# Verify binary
slsa-verifier verify-artifact \
  --provenance-path ocserv-agent-v0.3.0-linux-amd64.intoto.jsonl \
  --source-uri github.com/dantte-lp/ocserv-agent \
  ocserv-agent-v0.3.0-linux-amd64.tar.gz
```

</details>

---

**Full Diff:** [v0.2.1...v0.3.0](https://github.com/dantte-lp/ocserv-agent/compare/v0.2.1...v0.3.0)

**GitHub Release:** [v0.3.0](https://github.com/dantte-lp/ocserv-agent/releases/tag/v0.3.0)
