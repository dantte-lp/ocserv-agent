# Release Notes - v0.2.1

**Release Date:** 2025-10-23
**Type:** PATCH - CI/CD Infrastructure + Documentation
**Status:** BETA

## 📋 Summary

Infrastructure and documentation improvements. No code changes to core functionality.

## 🎯 Key Improvements

### CI/CD Pipeline (GitHub Actions)
- ✅ Complete CI/CD workflows with SLSA Level 3 provenance
- ✅ Smart path filtering - skips unnecessary checks for docs-only changes
- ✅ Multi-platform builds (Linux + FreeBSD: amd64, arm64)
- ✅ Comprehensive security scanning (gosec, CodeQL, Trivy, OSSF Scorecard)
- ✅ Automated dependency updates via Dependabot

### Documentation
- ✅ Comprehensive CONTRIBUTING.md guide
- ✅ Complete WORKFLOWS.md documentation
- ✅ Fixed README display on GitHub homepage
- ✅ Testing guide for production deployment

### Code Quality
- ✅ All Go code formatted with gofmt
- ✅ golangci-lint configuration (30+ linters)
- ✅ YAML and Markdown linting

## 📦 What's Changed

### GitHub Actions Workflows

**New Files:**
- `.github/workflows/ci.yml` - CI pipeline
  - Tests on Go 1.24 and 1.25
  - Multi-platform builds (Linux, FreeBSD)
  - Code quality checks
  - Coverage reporting to Codecov

- `.github/workflows/lint.yml` - Linting
  - golangci-lint (30+ linters)
  - Markdown lint
  - YAML lint
  - Dockerfile lint
  - **Smart filtering** - each lint runs only for its file type

- `.github/workflows/security.yml` - Security scanning
  - gosec (Go security scanner)
  - govulncheck (vulnerability database)
  - CodeQL (semantic analysis)
  - Trivy (container/filesystem scanner)
  - OSSF Scorecard
  - Weekly scheduled scans

- `.github/workflows/release.yml` - Release automation
  - SLSA Level 3 provenance
  - Multi-arch builds (amd64, arm64)
  - SHA256 checksums
  - GitHub Release creation
  - Container image (GHCR)

**Configuration:**
- `.golangci.yml` - golangci-lint config (30+ linters)
- `.yamllint.yml` - YAML linting rules
- `.github/dependabot.yml` - Auto dependency updates

### Documentation

**New Files:**
- `.github/CONTRIBUTING.md` (339 lines)
  - Complete development workflow
  - Branch protection rules
  - CI triggering explanation
  - Handling CI failures
  - Emergency hotfix process
  - Useful commands

- `.github/WORKFLOWS.md` (renaming from README.md)
  - Complete workflows documentation
  - SLSA verification instructions
  - Local development commands

**Updated:**
- `README.md` - Fixed GitHub homepage display
- Build matrix updated: Linux + FreeBSD (removed darwin/windows)

### Code Formatting

**Files formatted:**
- `internal/config/config.go`
- `internal/ocserv/manager.go`
- `internal/ocserv/occtl.go`
- `internal/ocserv/occtl_types.go`
- `test/mock-server/main.go`

### Dependencies

**Security Fix:**
- `golang.org/x/net`: 0.34.0 → 0.38.0 (fixes 2 moderate vulnerabilities)

## 🎨 Smart CI Triggering

The CI system now intelligently skips checks based on file changes:

### Documentation-only changes (.md files)
- ✅ Markdown lint - RUNS
- ❌ YAML lint, Dockerfile lint, golangci-lint - SKIPPED
- ❌ Tests, builds, security scans - SKIPPED

### Configuration-only changes (.yml/.yaml files)
- ✅ YAML lint - RUNS
- ❌ Other checks - SKIPPED

### Dockerfile changes
- ✅ Dockerfile lint - RUNS
- ❌ Other checks - SKIPPED

### Code changes (.go, .proto, go.mod, go.sum)
- ✅ **ALL checks run** - Full CI/Lint/Security

**Benefits:**
- Faster CI for documentation PRs
- Reduced resource usage
- Code changes still get full CI coverage

## 📊 Build Matrix

### Current Platforms

**Linux:**
- amd64 (x86_64)
- arm64 (aarch64)

**FreeBSD:**
- amd64 (x86_64)
- arm64 (aarch64)

**Removed:**
- darwin/macOS (not needed for server deployment)
- windows (not needed for server deployment)
- armv7 (not in build matrix)

## 🔒 Branch Protection

**Rules configured:**
- ❌ No force pushes to main
- ❌ No deletion of main branch
- ✅ All conversations must be resolved before merge
- ⚠️ Admins can bypass (use with caution)

**Required Status Checks:**
- Test (Go 1.25)
- Code Quality Checks
- golangci-lint

## 📈 Statistics

### Code Changes
- **Files changed:** 9
- **Lines added:** 434
- **Lines removed:** 8
- **Net change:** +426 lines

### Commits Since v0.2.0
- 8 commits
- 3 documentation updates
- 2 CI/CD improvements
- 2 code quality fixes
- 1 security fix

## 🔍 Compatibility

**No breaking changes** - fully compatible with v0.2.0

**Dependencies:**
- Go: 1.25
- gRPC: 1.69.4 → 1.69.4 (no change)
- protobuf: 1.36.4 → 1.36.4 (no change)
- zerolog: 1.33.0 → 1.33.0 (no change)
- golang.org/x/net: 0.34.0 → 0.38.0 (**security fix**)

## 🚀 Deployment

### From Binary

```bash
# Download latest release
curl -L https://github.com/dantte-lp/ocserv-agent/releases/download/v0.2.1/ocserv-agent-linux-amd64 -o ocserv-agent
chmod +x ocserv-agent
sudo mv ocserv-agent /usr/local/bin/
```

### Upgrade from v0.2.0

No special steps required - drop-in replacement:

```bash
# Backup current binary
sudo cp /usr/local/bin/ocserv-agent /usr/local/bin/ocserv-agent.v0.2.0

# Download new version
curl -L https://github.com/dantte-lp/ocserv-agent/releases/download/v0.2.1/ocserv-agent-linux-amd64 -o ocserv-agent
chmod +x ocserv-agent
sudo mv ocserv-agent /usr/local/bin/

# Restart service
sudo systemctl restart ocserv-agent
```

## 📝 Full Changelog

### CI/CD
- Add comprehensive GitHub Actions workflows (#10)
- Add smart path filtering for docs-only changes (#10)
- Add smart file-type filtering to lint workflow (#10)
- Update build matrix - remove darwin/windows, add FreeBSD (#10)

### Documentation
- Fix README display on GitHub homepage (#9)
- Add comprehensive contributing guide (#10)
- Fix build platforms in WORKFLOWS.md (#11)
- Add comprehensive testing guide for v0.2.0

### Code Quality
- Format Go code with gofmt (a6bfd55)

### Dependencies
- Bump golang.org/x/net from 0.34.0 to 0.38.0 (#8)

### Build
- Add go.sum for reproducible builds (ee9fbe3)

## 🐛 Known Issues

None reported for v0.2.1

## 🔮 Next Steps

See [TODO](../todo/CURRENT.md) for upcoming features.

**Planned for v0.3.0:**
- StreamLogs RPC implementation
- ShowEvents() streaming support
- ocpasswd wrapper
- UpdateConfig RPC

## 📚 References

- [GitHub Release](https://github.com/dantte-lp/ocserv-agent/releases/tag/v0.2.1)
- [Contributing Guide](../../.github/CONTRIBUTING.md)
- [Workflows Documentation](../../.github/WORKFLOWS.md)
- [Testing Guide](../../TESTING.md)
- [Previous Release (v0.2.0)](v0.2.0.md)

---

**Full Diff:** [v0.2.0...v0.2.1](https://github.com/dantte-lp/ocserv-agent/compare/v0.2.0...v0.2.1)
